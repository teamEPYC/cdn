"use strict";(()=>{var Oe=Object.defineProperty;var Le=(i,e,t)=>e in i?Oe(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var y=(i,e,t)=>Le(i,typeof e!="symbol"?e+"":e,t);var N=class{constructor(e){y(this,"form");this.form=e}gatherStepData(e){let t={};return e.forEach(o=>{o.name&&(t[o.name]=this.getFieldValue(o))}),t}gatherFormData(){let e=this.form.querySelectorAll("input, select, textarea"),t={};return e.forEach(o=>{let n=o;n.name&&(t[n.name]=this.getFieldValue(n))}),t}fillFormWithData(e){Object.keys(e).forEach(t=>{let o=this.form.querySelector(`[name="${t}"]`);if(o)if(o.type==="checkbox"){let n=o;e[t]&&n.click()}else if(o.type==="radio"){let n=this.form.querySelector(`input[name="${o.name}"][value="${e[t]}"]`);n&&n.click()}else o.value=e[t]}),window.FsAttributes&&window.FsAttributes.selectcustom&&(window.FsAttributes.selectcustom.destroy(),window.FsAttributes.selectcustom.init())}getFieldValue(e){if(e.type==="checkbox")return e.checked;if(e.type==="radio"){let t=this.form.querySelector(`input[name="${e.name}"]:checked`);return t?t.value:null}return e.value}};var M={NEXT_BUTTON:'[data-form="next-btn"]',PREV_BUTTON:'[data-form="back-btn"]',RESET_BUTTON:'[data-form="reset-btn"]',SUBMIT_BUTTON:'[data-form="submit-btn"]'},z=class{constructor(e='[data-form="multistep"]'){y(this,"form");if(this.form=document.querySelector(e),!this.form)throw new Error(`Form with selector "${e}" not found.`)}detectSteps(e='[data-form="step"]'){let t=this.form.querySelectorAll(e);if(t.length===0)throw new Error(`No steps found using selector "${e}".`);return Array.from(t)}detectButtons(){let e=this.form.querySelector(M.NEXT_BUTTON),t=this.form.querySelector(M.PREV_BUTTON),o=this.form.querySelector(M.RESET_BUTTON),n=this.form.querySelector(M.SUBMIT_BUTTON);return{nextButton:e,previousButton:t,resetButton:o,submitButton:n}}detectFieldsInStep(e){let o=this.detectSteps()[e];if(!o)throw new Error(`Step at index ${e} not found.`);let n=o.querySelectorAll("input, select, textarea");return Array.from(n)}detectFieldToValidateInStep(e){let o=this.detectSteps()[e];if(!o)throw new Error(`Step at index ${e} not found.`);let n=o.querySelectorAll("[data-validation]");return Array.from(n)}getTotalSteps(e='[data-form="step"]'){return this.detectSteps(e).length}addEventListenerToButtons(e,t){let o=this.getButtonSelectorByType(e);if(!o){console.error(`Unknown button type: "${e}"`);return}this.form.querySelectorAll(o).forEach(n=>{n.addEventListener("click",t)})}removeEventListenersFromButtons(e,t){let o=this.getButtonSelectorByType(e);if(!o){console.error(`Unknown button type: "${e}"`);return}this.form.querySelectorAll(o).forEach(n=>{n.removeEventListener("click",t)})}handleEnterKeyPress(e){this.form.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),e(t))})}getButtonSelectorByType(e){switch(e){case"NEXT":return M.NEXT_BUTTON;case"PREVIOUS":return M.PREV_BUTTON;case"RESET":return M.RESET_BUTTON;case"SUBMIT":return M.SUBMIT_BUTTON;default:return null}}};var D=class{constructor(e){y(this,"form");y(this,"errors",{});y(this,"validators",{required:e=>({valid:e.trim()!=="",message:"This field is required."}),min:(e,t)=>({valid:e.length>=parseInt(t,10),message:`Minimum length is ${t} characters.`}),max:(e,t)=>({valid:e.length<=parseInt(t,10),message:`Maximum length is ${t} characters.`}),startswith:(e,t)=>({valid:e.startsWith(t),message:`Value must start with "${t}".`}),endswith:(e,t)=>({valid:e.endsWith(t),message:`Value must end with "${t}".`}),regex:(e,t)=>({valid:new RegExp(t).test(e),message:"Value does not match the required pattern."}),contains:(e,t)=>({valid:e.includes(t),message:`Value must contain "${t}".`}),notcontains:(e,t)=>({valid:!e.includes(t),message:`Value must not contain "${t}".`}),equals:(e,t)=>({valid:e===t,message:`Value must be exactly "${t}".`}),notequals:(e,t)=>({valid:e!==t,message:`Value must not be "${t}".`}),alphanumeric:e=>({valid:/^[a-zA-Z0-9]+$/.test(e),message:"Value must be alphanumeric."}),email:e=>({valid:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),message:"Enter a valid email address."}),phone:()=>({valid:iti.isValidNumber(),message:"Enter a valid phone number."}),"checkbox-group":e=>{let t=e.querySelectorAll('input[type="checkbox"]');return console.log("[+] checkboxes",t),{valid:Array.from(t).some(n=>(console.log("[+] CHECKBOX",n,n.checked),n.checked)),message:"Please select at least one option."}}});y(this,"errorSelector",".onb-form-field-error");this.form=e}validateField(e){let t=e.getAttribute("data-validation"),o={valid:!0,message:""},n=e.name||"";if(e.hasAttribute("required")&&(t="required;"+t),t){let r=e.value,a=t.split(";");for(let u of a){let[h,g]=u.split(":");if(this.validators[h]){let s={valid:!0,message:""};u==="checkbox-group"?(s=this.validators["checkbox-group"](e),n=e.getAttribute("data-group")||""):s=this.validators[h](r,g);let{valid:c,message:l}=s;if(o={valid:c,message:l},!c){let d=e.getAttribute(`data-error-${h}`);o.message=d||l;break}}}}return o.valid?delete this.errors[n]:(console.log("[+] field",e),this.errors[n]=o.message),o}validateStep(e){let t=!0;return e.forEach(o=>{this.validateField(o).valid||(t=!1)}),{isStepValid:t,errors:this.errors}}getErrors(){return this.errors}showFieldError(e){this.clearFieldError(e);let t=this.getErrorContainer(e);t&&this.errors[e.name]&&(console.log("%c[+] SHOWING ERROR FIELD","color:red",e.name),t.textContent=this.errors[e.name],t.style.display="block")}clearStepErrors(){console.log("[+] Clearing Step Errors");let e=this.form.querySelectorAll(this.errorSelector);e&&e.length>0&&e.forEach(t=>{t.textContent="",t.style.display="none"})}clearFieldError(e){let t=this.getErrorContainer(e);console.log("[+] Clearing Error Field"),t&&(t.textContent="",t.style.display="none")}showGlobalError(e){let t=this.form.querySelector('[data-form="global-error"]');t&&(t.textContent=e,t.style.display="block")}clearGlobalError(){let e=this.form.querySelector('[data-form="global-error"]');e&&(e.textContent="",e.style.display="none")}getErrorContainer(e){return e.closest(".onb-form-field-comp")?.querySelector(this.errorSelector)}};var W=class{constructor(e,t,o,n){y(this,"form");y(this,"steps",[]);y(this,"customProgressBar");y(this,"buttons",{nextButton:null,previousButton:null,resetButton:null,submitButton:null});this.form=e,this.steps=t,this.buttons=o,this.customProgressBar=n}showStep(e){this.steps.forEach((t,o)=>{t.style.display=o===e?"block":"none"}),this.handleCustomProgressBar(e)}handleCustomProgressBar(e){this.customProgressBar?.forEach((t,o)=>{if(t){let n=t.querySelectorAll(" :scope > *");n.length==this.steps.length&&n.forEach((r,a)=>{a===e?r.classList.add("current"):r.classList.remove("current")})}})}hideSteps(){}disableButtons(){console.log("[+] Disabling Buttons"),Object.values(this.buttons).forEach(e=>{e&&e.setAttribute("disabled","true")})}enableButtons(){Object.values(this.buttons).forEach(e=>{e&&e.removeAttribute("disabled")})}resetUI(){console.log("[+] Resetting UI"),this.hideSteps(),this.enableButtons(),this.steps.length>0&&this.showStep(0)}};var Me=i=>{},Z=class{constructor({formSelector:e,inputErrorMessageSelector:t=".onb-form-field-error",options:o={},onStepChange:n}){y(this,"form");y(this,"state",{currentStep:0,totalSteps:0,formData:{},errors:{},direction:""});y(this,"selectors",{inputErrorMessageSelector:".onb-form-field-error",customProgressBar:".onb-prog-comp"});y(this,"steps",[]);y(this,"formManager");y(this,"uiManager");y(this,"validationManager");y(this,"dataManager");y(this,"callbacks",{onStepChange:Me});y(this,"options",{});if(this.form=document.querySelector(e),!this.form)throw new Error(`Form with selector "${e}" not found.`);this.selectors.inputErrorMessageSelector=t,this.formManager=new z(e);let r=this.formManager.form;this.steps=this.formManager.detectSteps();let a=this.formManager.detectButtons(),u=this.form.querySelectorAll(`${this.selectors.customProgressBar}`);this.uiManager=new W(r,this.steps,a,u),this.validationManager=new D(r),this.dataManager=new N(r),this.callbacks.onStepChange=n,this.options=o}initialize(){this.loadLocalStorage(),this.updateState({totalSteps:this.steps.length},!1),this.dataManager.fillFormWithData(this.getState().formData),this.uiManager.showStep(this.state.currentStep),this.validationManager.clearStepErrors(),this.attachEventListeners(),console.log("[+] INITIAL STATE",JSON.stringify(this.state,null,2))}loadLocalStorage(){let e=localStorage.getItem("formState");if(e){let t=JSON.parse(e);this.state={...t}}}updateState({currentStep:e,totalSteps:t,formData:o,errors:n,direction:r},a=!0){isNaN(e)===!1&&(this.state.currentStep=e),t&&(this.state.totalSteps=t),o&&(this.state.formData=o),n&&(this.state.errors=n),r&&(this.state.direction=r),localStorage.setItem("formState",JSON.stringify(this.state)),a&&this.callbacks.onStepChange(this.state)}incrementCurrentStep(){if(this.state.currentStep<this.state.totalSteps){let t=this.getState().currentStep+1;this.updateState({currentStep:t})}}decrementCurrentStep(e){if(console.log("] decrementCurrentStep",e),this.state.currentStep>0){let o=this.getState().currentStep-1;this.updateState({currentStep:o})}}getState(){return JSON.parse(JSON.stringify(this.state))}attachEventListeners(){this.formManager.addEventListenerToButtons("NEXT",()=>{this.action_next()}),this.formManager.addEventListenerToButtons("PREVIOUS",()=>{this.action_previous()}),this.formManager.addEventListenerToButtons("SUBMIT",e=>{this.submit(e)}),this.form.addEventListener("keydown",e=>{e.key==="Enter"&&(e.preventDefault(),this.action_next())})}action_updateDataAndError(){let e=this.formManager.detectFieldsInStep(this.state.currentStep),t=this.formManager.detectFieldToValidateInStep(this.state.currentStep),{isStepValid:o,errors:n}=this.validationManager.validateStep(t),r=this.dataManager.gatherStepData(e);return console.log(" THIS STEP DATA",r),console.log("[+] THIS STEP ERRORS",n),this.updateState({formData:r,errors:n}),o}isLastStep(){return this.state.currentStep===this.state.totalSteps-1}action_next(){if(this.state.direction="NEXT",this.action_updateDataAndError())if(this.isLastStep())this.options.afterSubmitRedrect?window.location.href=this.options.afterSubmitRedrect:window.location.href="/?submitted=true";else{this.incrementCurrentStep();let t=this.getState();console.log("[+] NEXT STATE:",JSON.stringify(t,null,2));let o=t.currentStep;this.uiManager.showStep(o),this.validationManager.clearStepErrors()}else this.showErrorsInThisStep()}submit(e){console.log("[+] Submitting Form",e),this.action_next()}action_previous(){this.state.direction="PREVIOUS";let e=this.getState();console.log("[+] PREVIOUS STATE:",e);let t=e.currentStep-1;this.uiManager.showStep(t),this.decrementCurrentStep(this.state.currentStep)}showErrorsInThisStep(){let e=this.formManager.detectFieldToValidateInStep(this.state.currentStep),t=this.formManager.detectFieldsInStep(this.state.currentStep);e.forEach(o=>{this.validationManager.showFieldError(o)})}};function E(i,e){var t={};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&e.indexOf(o)<0&&(t[o]=i[o]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function"){var n=0;for(o=Object.getOwnPropertySymbols(i);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(i,o[n])&&(t[o[n]]=i[o[n]])}return t}var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ce(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function le(i,e){return i(e={exports:{}},e.exports),e.exports}var C=le(function(i,e){Object.defineProperty(e,"__esModule",{value:!0});var t=function(){function o(){var n=this;this.locked=new Map,this.addToLocked=function(r,a){var u=n.locked.get(r);u===void 0?a===void 0?n.locked.set(r,[]):n.locked.set(r,[a]):a!==void 0&&(u.unshift(a),n.locked.set(r,u))},this.isLocked=function(r){return n.locked.has(r)},this.lock=function(r){return new Promise(function(a,u){n.isLocked(r)?n.addToLocked(r,a):(n.addToLocked(r),a())})},this.unlock=function(r){var a=n.locked.get(r);if(a!==void 0&&a.length!==0){var u=a.pop();n.locked.set(r,a),u!==void 0&&setTimeout(u,0)}else n.locked.delete(r)}}return o.getInstance=function(){return o.instance===void 0&&(o.instance=new o),o.instance},o}();e.default=function(){return t.getInstance()}});ce(C);var Ce=ce(le(function(i,e){var t=P&&P.__awaiter||function(s,c,l,d){return new(l||(l=Promise))(function(m,w){function f(v){try{S(d.next(v))}catch(p){w(p)}}function b(v){try{S(d.throw(v))}catch(p){w(p)}}function S(v){v.done?m(v.value):new l(function(p){p(v.value)}).then(f,b)}S((d=d.apply(s,c||[])).next())})},o=P&&P.__generator||function(s,c){var l,d,m,w,f={label:0,sent:function(){if(1&m[0])throw m[1];return m[1]},trys:[],ops:[]};return w={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function b(S){return function(v){return function(p){if(l)throw new TypeError("Generator is already executing.");for(;f;)try{if(l=1,d&&(m=2&p[0]?d.return:p[0]?d.throw||((m=d.return)&&m.call(d),0):d.next)&&!(m=m.call(d,p[1])).done)return m;switch(d=0,m&&(p=[2&p[0],m.value]),p[0]){case 0:case 1:m=p;break;case 4:return f.label++,{value:p[1],done:!1};case 5:f.label++,d=p[1],p=[0];continue;case 7:p=f.ops.pop(),f.trys.pop();continue;default:if(m=f.trys,!((m=m.length>0&&m[m.length-1])||p[0]!==6&&p[0]!==2)){f=0;continue}if(p[0]===3&&(!m||p[1]>m[0]&&p[1]<m[3])){f.label=p[1];break}if(p[0]===6&&f.label<m[1]){f.label=m[1],m=p;break}if(m&&f.label<m[2]){f.label=m[2],f.ops.push(p);break}m[2]&&f.ops.pop(),f.trys.pop();continue}p=c.call(s,f)}catch(T){p=[6,T],d=0}finally{l=m=0}if(5&p[0])throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}([S,v])}}},n=P;Object.defineProperty(e,"__esModule",{value:!0});var r="browser-tabs-lock-key",a={key:function(s){return t(n,void 0,void 0,function(){return o(this,function(c){throw new Error("Unsupported")})})},getItem:function(s){return t(n,void 0,void 0,function(){return o(this,function(c){throw new Error("Unsupported")})})},clear:function(){return t(n,void 0,void 0,function(){return o(this,function(s){return[2,window.localStorage.clear()]})})},removeItem:function(s){return t(n,void 0,void 0,function(){return o(this,function(c){throw new Error("Unsupported")})})},setItem:function(s,c){return t(n,void 0,void 0,function(){return o(this,function(l){throw new Error("Unsupported")})})},keySync:function(s){return window.localStorage.key(s)},getItemSync:function(s){return window.localStorage.getItem(s)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(s){return window.localStorage.removeItem(s)},setItemSync:function(s,c){return window.localStorage.setItem(s,c)}};function u(s){return new Promise(function(c){return setTimeout(c,s)})}function h(s){for(var c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",l="",d=0;d<s;d++)l+=c[Math.floor(Math.random()*c.length)];return l}var g=function(){function s(c){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+h(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=c,s.waiters===void 0&&(s.waiters=[])}return s.prototype.acquireLock=function(c,l){return l===void 0&&(l=5e3),t(this,void 0,void 0,function(){var d,m,w,f,b,S,v;return o(this,function(p){switch(p.label){case 0:d=Date.now()+h(4),m=Date.now()+l,w=r+"-"+c,f=this.storageHandler===void 0?a:this.storageHandler,p.label=1;case 1:return Date.now()<m?[4,u(30)]:[3,8];case 2:return p.sent(),f.getItemSync(w)!==null?[3,5]:(b=this.id+"-"+c+"-"+d,[4,u(Math.floor(25*Math.random()))]);case 3:return p.sent(),f.setItemSync(w,JSON.stringify({id:this.id,iat:d,timeoutKey:b,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,u(30)];case 4:return p.sent(),(S=f.getItemSync(w))!==null&&(v=JSON.parse(S)).id===this.id&&v.iat===d?(this.acquiredIatSet.add(d),this.refreshLockWhileAcquired(w,d),[2,!0]):[3,7];case 5:return s.lockCorrector(this.storageHandler===void 0?a:this.storageHandler),[4,this.waitForSomethingToChange(m)];case 6:p.sent(),p.label=7;case 7:return d=Date.now()+h(4),[3,1];case 8:return[2,!1]}})})},s.prototype.refreshLockWhileAcquired=function(c,l){return t(this,void 0,void 0,function(){var d=this;return o(this,function(m){return setTimeout(function(){return t(d,void 0,void 0,function(){var w,f,b;return o(this,function(S){switch(S.label){case 0:return[4,C.default().lock(l)];case 1:return S.sent(),this.acquiredIatSet.has(l)?(w=this.storageHandler===void 0?a:this.storageHandler,(f=w.getItemSync(c))===null?(C.default().unlock(l),[2]):((b=JSON.parse(f)).timeRefreshed=Date.now(),w.setItemSync(c,JSON.stringify(b)),C.default().unlock(l),this.refreshLockWhileAcquired(c,l),[2])):(C.default().unlock(l),[2])}})})},1e3),[2]})})},s.prototype.waitForSomethingToChange=function(c){return t(this,void 0,void 0,function(){return o(this,function(l){switch(l.label){case 0:return[4,new Promise(function(d){var m=!1,w=Date.now(),f=!1;function b(){if(f||(window.removeEventListener("storage",b),s.removeFromWaiting(b),clearTimeout(S),f=!0),!m){m=!0;var v=50-(Date.now()-w);v>0?setTimeout(d,v):d(null)}}window.addEventListener("storage",b),s.addToWaiting(b);var S=setTimeout(b,Math.max(0,c-Date.now()))})];case 1:return l.sent(),[2]}})})},s.addToWaiting=function(c){this.removeFromWaiting(c),s.waiters!==void 0&&s.waiters.push(c)},s.removeFromWaiting=function(c){s.waiters!==void 0&&(s.waiters=s.waiters.filter(function(l){return l!==c}))},s.notifyWaiters=function(){s.waiters!==void 0&&s.waiters.slice().forEach(function(c){return c()})},s.prototype.releaseLock=function(c){return t(this,void 0,void 0,function(){return o(this,function(l){switch(l.label){case 0:return[4,this.releaseLock__private__(c)];case 1:return[2,l.sent()]}})})},s.prototype.releaseLock__private__=function(c){return t(this,void 0,void 0,function(){var l,d,m,w;return o(this,function(f){switch(f.label){case 0:return l=this.storageHandler===void 0?a:this.storageHandler,d=r+"-"+c,(m=l.getItemSync(d))===null?[2]:(w=JSON.parse(m)).id!==this.id?[3,2]:[4,C.default().lock(w.iat)];case 1:f.sent(),this.acquiredIatSet.delete(w.iat),l.removeItemSync(d),C.default().unlock(w.iat),s.notifyWaiters(),f.label=2;case 2:return[2]}})})},s.lockCorrector=function(c){for(var l=Date.now()-5e3,d=c,m=[],w=0;;){var f=d.keySync(w);if(f===null)break;m.push(f),w++}for(var b=!1,S=0;S<m.length;S++){var v=m[S];if(v.includes(r)){var p=d.getItemSync(v);if(p!==null){var T=JSON.parse(p);(T.timeRefreshed===void 0&&T.timeAcquired<l||T.timeRefreshed!==void 0&&T.timeRefreshed<l)&&(d.removeItemSync(v),b=!0)}}}b&&s.notifyWaiters()},s.waiters=void 0,s}();e.default=g})),Pe={timeoutInSeconds:60},be={name:"auth0-spa-js",version:"2.1.3"},Se=()=>Date.now(),k=class i extends Error{constructor(e,t){super(t),this.error=e,this.error_description=t,Object.setPrototypeOf(this,i.prototype)}static fromPayload({error:e,error_description:t}){return new i(e,t)}},Q=class i extends k{constructor(e,t,o,n=null){super(e,t),this.state=o,this.appState=n,Object.setPrototypeOf(this,i.prototype)}},H=class i extends k{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,i.prototype)}},ee=class i extends H{constructor(e){super(),this.popup=e,Object.setPrototypeOf(this,i.prototype)}},te=class i extends k{constructor(e){super("cancelled","Popup closed"),this.popup=e,Object.setPrototypeOf(this,i.prototype)}},oe=class i extends k{constructor(e,t,o){super(e,t),this.mfa_token=o,Object.setPrototypeOf(this,i.prototype)}},B=class i extends k{constructor(e,t){super("missing_refresh_token",`Missing Refresh Token (audience: '${he(e,["default"])}', scope: '${he(t)}')`),this.audience=e,this.scope=t,Object.setPrototypeOf(this,i.prototype)}};function he(i,e=[]){return i&&!e.includes(i)?i:""}var K=()=>window.crypto,G=()=>{let i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",e="";return Array.from(K().getRandomValues(new Uint8Array(43))).forEach(t=>e+=i[t%i.length]),e},me=i=>btoa(i),ne=i=>{var{clientId:e}=i,t=E(i,["clientId"]);return new URLSearchParams((o=>Object.keys(o).filter(n=>o[n]!==void 0).reduce((n,r)=>Object.assign(Object.assign({},n),{[r]:o[r]}),{}))(Object.assign({client_id:e},t))).toString()},pe=i=>(e=>decodeURIComponent(atob(e).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))(i.replace(/_/g,"/").replace(/-/g,"+")),xe=async(i,e)=>{let t=await fetch(i,e);return{ok:t.ok,json:await t.json()}},Ae=async(i,e,t)=>{let o=new AbortController,n;return e.signal=o.signal,Promise.race([xe(i,e),new Promise((r,a)=>{n=setTimeout(()=>{o.abort(),a(new Error("Timeout when executing 'fetch'"))},t)})]).finally(()=>{clearTimeout(n)})},Re=async(i,e,t,o,n,r,a)=>{return u={auth:{audience:e,scope:t},timeout:n,fetchUrl:i,fetchOptions:o,useFormData:a},h=r,new Promise(function(g,s){let c=new MessageChannel;c.port1.onmessage=function(l){l.data.error?s(new Error(l.data.error)):g(l.data),c.port1.close()},h.postMessage(u,[c.port2])});var u,h},Ue=async(i,e,t,o,n,r,a=1e4)=>n?Re(i,e,t,o,a,n,r):Ae(i,o,a);async function He(i,e){var{baseUrl:t,timeout:o,audience:n,scope:r,auth0Client:a,useFormData:u}=i,h=E(i,["baseUrl","timeout","audience","scope","auth0Client","useFormData"]);let g=u?ne(h):JSON.stringify(h);return await async function(s,c,l,d,m,w,f){let b,S=null;for(let L=0;L<3;L++)try{b=await Ue(s,l,d,m,w,f,c),S=null;break}catch(_e){S=_e}if(S)throw S;let v=b.json,{error:p,error_description:T}=v,j=E(v,["error","error_description"]),{ok:_}=b;if(!_){let L=T||`HTTP error. Unable to fetch ${s}`;throw p==="mfa_required"?new oe(p,L,j.mfa_token):p==="missing_refresh_token"?new B(l,d):new k(p||"request_error",L)}return j}(`${t}/oauth/token`,o,n||"default",r,{method:"POST",body:g,headers:{"Content-Type":u?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(a||be))}},e,u)}var F=(...i)=>{return(e=i.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(e))).join(" ");var e},O=class i{constructor(e,t="@@auth0spajs@@",o){this.prefix=t,this.suffix=o,this.clientId=e.clientId,this.scope=e.scope,this.audience=e.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(e){let[t,o,n,r]=e.split("::");return new i({clientId:o,scope:r,audience:n},t)}static fromCacheEntry(e){let{scope:t,audience:o,client_id:n}=e;return new i({scope:t,audience:o,clientId:n})}},ie=class{set(e,t){localStorage.setItem(e,JSON.stringify(t))}get(e){let t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch{return}}remove(e){localStorage.removeItem(e)}allKeys(){return Object.keys(window.localStorage).filter(e=>e.startsWith("@@auth0spajs@@"))}},V=class{constructor(){this.enclosedCache=function(){let e={};return{set(t,o){e[t]=o},get(t){let o=e[t];if(o)return o},remove(t){delete e[t]},allKeys:()=>Object.keys(e)}}()}},re=class{constructor(e,t,o){this.cache=e,this.keyManifest=t,this.nowProvider=o||Se}async setIdToken(e,t,o){var n;let r=this.getIdTokenCacheKey(e);await this.cache.set(r,{id_token:t,decodedToken:o}),await((n=this.keyManifest)===null||n===void 0?void 0:n.add(r))}async getIdToken(e){let t=await this.cache.get(this.getIdTokenCacheKey(e.clientId));if(!t&&e.scope&&e.audience){let o=await this.get(e);return!o||!o.id_token||!o.decodedToken?void 0:{id_token:o.id_token,decodedToken:o.decodedToken}}if(t)return{id_token:t.id_token,decodedToken:t.decodedToken}}async get(e,t=0){var o;let n=await this.cache.get(e.toKey());if(!n){let u=await this.getCacheKeys();if(!u)return;let h=this.matchExistingCacheKey(e,u);h&&(n=await this.cache.get(h))}if(!n)return;let r=await this.nowProvider(),a=Math.floor(r/1e3);return n.expiresAt-t<a?n.body.refresh_token?(n.body={refresh_token:n.body.refresh_token},await this.cache.set(e.toKey(),n),n.body):(await this.cache.remove(e.toKey()),void await((o=this.keyManifest)===null||o===void 0?void 0:o.remove(e.toKey()))):n.body}async set(e){var t;let o=new O({clientId:e.client_id,scope:e.scope,audience:e.audience}),n=await this.wrapCacheEntry(e);await this.cache.set(o.toKey(),n),await((t=this.keyManifest)===null||t===void 0?void 0:t.add(o.toKey()))}async clear(e){var t;let o=await this.getCacheKeys();o&&(await o.filter(n=>!e||n.includes(e)).reduce(async(n,r)=>{await n,await this.cache.remove(r)},Promise.resolve()),await((t=this.keyManifest)===null||t===void 0?void 0:t.clear()))}async wrapCacheEntry(e){let t=await this.nowProvider();return{body:e,expiresAt:Math.floor(t/1e3)+e.expires_in}}async getCacheKeys(){var e;return this.keyManifest?(e=await this.keyManifest.get())===null||e===void 0?void 0:e.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(e){return new O({clientId:e},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(e,t){return t.filter(o=>{var n;let r=O.fromKey(o),a=new Set(r.scope&&r.scope.split(" ")),u=((n=e.scope)===null||n===void 0?void 0:n.split(" "))||[],h=r.scope&&u.reduce((g,s)=>g&&a.has(s),!0);return r.prefix==="@@auth0spajs@@"&&r.clientId===e.clientId&&r.audience===e.audience&&h})[0]}},se=class{constructor(e,t,o){this.storage=e,this.clientId=t,this.cookieDomain=o,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(e){this.storage.save(this.storageKey,e,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}},U=i=>typeof i=="number",je=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],Ne=i=>{if(!i.id_token)throw new Error("ID token is required but missing");let e=(r=>{let a=r.split("."),[u,h,g]=a;if(a.length!==3||!u||!h||!g)throw new Error("ID token could not be decoded");let s=JSON.parse(pe(h)),c={__raw:r},l={};return Object.keys(s).forEach(d=>{c[d]=s[d],je.includes(d)||(l[d]=s[d])}),{encoded:{header:u,payload:h,signature:g},header:JSON.parse(pe(u)),claims:c,user:l}})(i.id_token);if(!e.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(e.claims.iss!==i.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${i.iss}", found "${e.claims.iss}"`);if(!e.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(e.header.alg!=="RS256")throw new Error(`Signature algorithm of "${e.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!e.claims.aud||typeof e.claims.aud!="string"&&!Array.isArray(e.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(e.claims.aud)){if(!e.claims.aud.includes(i.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${i.aud}" but was not one of "${e.claims.aud.join(", ")}"`);if(e.claims.aud.length>1){if(!e.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(e.claims.azp!==i.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${i.aud}", found "${e.claims.azp}"`)}}else if(e.claims.aud!==i.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${i.aud}" but found "${e.claims.aud}"`);if(i.nonce){if(!e.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(e.claims.nonce!==i.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${i.nonce}", found "${e.claims.nonce}"`)}if(i.max_age&&!U(e.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(e.claims.exp==null||!U(e.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!U(e.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");let t=i.leeway||60,o=new Date(i.now||Date.now()),n=new Date(0);if(n.setUTCSeconds(e.claims.exp+t),o>n)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${o}) is after expiration time (${n})`);if(e.claims.nbf!=null&&U(e.claims.nbf)){let r=new Date(0);if(r.setUTCSeconds(e.claims.nbf-t),o<r)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${o}) is before ${r}`)}if(e.claims.auth_time!=null&&U(e.claims.auth_time)){let r=new Date(0);if(r.setUTCSeconds(parseInt(e.claims.auth_time)+i.max_age+t),o>r)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${o}) is after last auth at ${r}`)}if(i.organization){let r=i.organization.trim();if(r.startsWith("org_")){let a=r;if(!e.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(a!==e.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${a}", found "${e.claims.org_id}"`)}else{let a=r.toLowerCase();if(!e.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==e.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${a}", found "${e.claims.org_name}"`)}}return e},x=le(function(i,e){var t=P&&P.__assign||function(){return t=Object.assign||function(h){for(var g,s=1,c=arguments.length;s<c;s++)for(var l in g=arguments[s])Object.prototype.hasOwnProperty.call(g,l)&&(h[l]=g[l]);return h},t.apply(this,arguments)};function o(h,g){if(!g)return"";var s="; "+h;return g===!0?s:s+"="+g}function n(h,g,s){return encodeURIComponent(h).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(g).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(c){if(typeof c.expires=="number"){var l=new Date;l.setMilliseconds(l.getMilliseconds()+864e5*c.expires),c.expires=l}return o("Expires",c.expires?c.expires.toUTCString():"")+o("Domain",c.domain)+o("Path",c.path)+o("Secure",c.secure)+o("SameSite",c.sameSite)}(s)}function r(h){for(var g={},s=h?h.split("; "):[],c=/(%[\dA-F]{2})+/gi,l=0;l<s.length;l++){var d=s[l].split("="),m=d.slice(1).join("=");m.charAt(0)==='"'&&(m=m.slice(1,-1));try{g[d[0].replace(c,decodeURIComponent)]=m.replace(c,decodeURIComponent)}catch{}}return g}function a(){return r(document.cookie)}function u(h,g,s){document.cookie=n(h,g,t({path:"/"},s))}e.__esModule=!0,e.encode=n,e.parse=r,e.getAll=a,e.get=function(h){return a()[h]},e.set=u,e.remove=function(h,g){u(h,"",t(t({},g),{expires:-1}))}});ce(x),x.encode,x.parse,x.getAll;var ze=x.get,ke=x.set,Te=x.remove,R={get(i){let e=ze(i);if(e!==void 0)return JSON.parse(e)},save(i,e,t){let o={};window.location.protocol==="https:"&&(o={secure:!0,sameSite:"none"}),t?.daysUntilExpire&&(o.expires=t.daysUntilExpire),t?.cookieDomain&&(o.domain=t.cookieDomain),ke(i,JSON.stringify(e),o)},remove(i,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Te(i,t)}},De={get(i){return R.get(i)||R.get(`_legacy_${i}`)},save(i,e,t){let o={};window.location.protocol==="https:"&&(o={secure:!0}),t?.daysUntilExpire&&(o.expires=t.daysUntilExpire),t?.cookieDomain&&(o.domain=t.cookieDomain),ke(`_legacy_${i}`,JSON.stringify(e),o),R.save(i,e,t)},remove(i,e){let t={};e?.cookieDomain&&(t.domain=e.cookieDomain),Te(i,t),R.remove(i,e),R.remove(`_legacy_${i}`,e)}},We={get(i){if(typeof sessionStorage>"u")return;let e=sessionStorage.getItem(i);return e!=null?JSON.parse(e):void 0},save(i,e){sessionStorage.setItem(i,JSON.stringify(e))},remove(i){sessionStorage.removeItem(i)}};function Ze(i,e,t){var o=e===void 0?null:e,n=function(h,g){var s=atob(h);if(g){for(var c=new Uint8Array(s.length),l=0,d=s.length;l<d;++l)c[l]=s.charCodeAt(l);return String.fromCharCode.apply(null,new Uint16Array(c.buffer))}return s}(i,t!==void 0&&t),r=n.indexOf(`
`,10)+1,a=n.substring(r)+(o?"//# sourceMappingURL="+o:""),u=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(u)}var ge,fe,we,$,Fe=(ge="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+YCR7ZX18JHt0fWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDpyLGZldGNoVXJsOmksZmV0Y2hPcHRpb25zOmMsdXNlRm9ybURhdGE6YX0scG9ydHM6W3BdfSk9PntsZXQgZjtjb25zdHthdWRpZW5jZTp1LHNjb3BlOmx9PXJ8fHt9O3RyeXtjb25zdCByPWE/KGU9Pntjb25zdCB0PW5ldyBVUkxTZWFyY2hQYXJhbXMoZSkscj17fTtyZXR1cm4gdC5mb3JFYWNoKCgoZSx0KT0+e3JbdF09ZX0pKSxyfSkoYy5ib2R5KTpKU09OLnBhcnNlKGMuYm9keSk7aWYoIXIucmVmcmVzaF90b2tlbiYmInJlZnJlc2hfdG9rZW4iPT09ci5ncmFudF90eXBlKXtjb25zdCBlPSgoZSx0KT0+b1tuKGUsdCldKSh1LGwpO2lmKCFlKXRocm93IG5ldyB0KHUsbCk7Yy5ib2R5PWE/cyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JlZnJlc2hfdG9rZW46ZX0pKTpKU09OLnN0cmluZ2lmeShPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JlZnJlc2hfdG9rZW46ZX0pKX1sZXQgaCxnOyJmdW5jdGlvbiI9PXR5cGVvZiBBYm9ydENvbnRyb2xsZXImJihoPW5ldyBBYm9ydENvbnRyb2xsZXIsYy5zaWduYWw9aC5zaWduYWwpO3RyeXtnPWF3YWl0IFByb21pc2UucmFjZShbKGQ9ZSxuZXcgUHJvbWlzZSgoZT0+c2V0VGltZW91dChlLGQpKSkpLGZldGNoKGksT2JqZWN0LmFzc2lnbih7fSxjKSldKX1jYXRjaChlKXtyZXR1cm4gdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjplLm1lc3NhZ2V9KX1pZighZylyZXR1cm4gaCYmaC5hYm9ydCgpLHZvaWQgcC5wb3N0TWVzc2FnZSh7ZXJyb3I6IlRpbWVvdXQgd2hlbiBleGVjdXRpbmcgJ2ZldGNoJyJ9KTtmPWF3YWl0IGcuanNvbigpLGYucmVmcmVzaF90b2tlbj8oKChlLHQscik9PntvW24odCxyKV09ZX0pKGYucmVmcmVzaF90b2tlbix1LGwpLGRlbGV0ZSBmLnJlZnJlc2hfdG9rZW4pOigoZSx0KT0+e2RlbGV0ZSBvW24oZSx0KV19KSh1LGwpLHAucG9zdE1lc3NhZ2Uoe29rOmcub2ssanNvbjpmfSl9Y2F0Y2goZSl7cC5wb3N0TWVzc2FnZSh7b2s6ITEsanNvbjp7ZXJyb3I6ZS5lcnJvcixlcnJvcl9kZXNjcmlwdGlvbjplLm1lc3NhZ2V9fSl9dmFyIGR9KSl9KCk7Cgo=",fe=null,we=!1,function(i){return $=$||Ze(ge,fe,we),new Worker($,i)}),Y={},ae=class{constructor(e,t){this.cache=e,this.clientId=t,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(e){var t;let o=new Set(((t=await this.cache.get(this.manifestKey))===null||t===void 0?void 0:t.keys)||[]);o.add(e),await this.cache.set(this.manifestKey,{keys:[...o]})}async remove(e){let t=await this.cache.get(this.manifestKey);if(t){let o=new Set(t.keys);return o.delete(e),o.size>0?await this.cache.set(this.manifestKey,{keys:[...o]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(e){return`@@auth0spajs@@::${e}`}},Ke={memory:()=>new V().enclosedCache,localstorage:()=>new ie},ye=i=>Ke[i],ve=i=>{let{openUrl:e,onRedirect:t}=i,o=E(i,["openUrl","onRedirect"]);return Object.assign(Object.assign({},o),{openUrl:e===!1||e?e:t})},q=new Ce,X=class{constructor(e){let t,o;if(this.userCache=new V().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await q.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),e),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),e.authorizationParams)}),typeof window<"u"&&(()=>{if(!K())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(K().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),e.cache&&e.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),e.cache)o=e.cache;else{if(t=e.cacheLocation||"memory",!ye(t))throw new Error(`Invalid cache location "${t}"`);o=ye(t)()}this.httpTimeoutMs=e.httpTimeoutInSeconds?1e3*e.httpTimeoutInSeconds:1e4,this.cookieStorage=e.legacySameSiteCookie===!1?R:De,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(a=>`auth0.${a}.is.authenticated`)(this.options.clientId),this.sessionCheckExpiryDays=e.sessionCheckExpiryDays||1;let n=e.useCookiesForTransactions?this.cookieStorage:We;var r;this.scope=F("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new se(n,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||Se,this.cacheManager=new re(o,o.allKeys?void 0:new ae(o,this.options.clientId),this.nowProvider),this.domainUrl=(r=this.options.domain,/^https?:\/\//.test(r)?r:`https://${r}`),this.tokenIssuer=((a,u)=>a?a.startsWith("https://")?a:`https://${a}/`:`${u}/`)(this.options.issuer,this.domainUrl),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&t==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new Fe)}_url(e){let t=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||be)));return`${this.domainUrl}${e}&auth0Client=${t}`}_authorizeUrl(e){return this._url(`/authorize?${ne(e)}`)}async _verifyIdToken(e,t,o){let n=await this.nowProvider();return Ne({iss:this.tokenIssuer,aud:this.options.clientId,id_token:e,nonce:t,organization:o,leeway:this.options.leeway,max_age:(r=this.options.authorizationParams.max_age,typeof r!="string"?r:parseInt(r,10)||void 0),now:n});var r}_processOrgHint(e){e?this.cookieStorage.save(this.orgHintCookieName,e,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(e,t,o){let n=me(G()),r=me(G()),a=G(),u=(s=>{let c=new Uint8Array(s);return(l=>{let d={"+":"-","/":"_","=":""};return l.replace(/[+/=]/g,m=>d[m])})(window.btoa(String.fromCharCode(...Array.from(c))))})(await(async s=>await K().subtle.digest({name:"SHA-256"},new TextEncoder().encode(s)))(a)),h=((s,c,l,d,m,w,f,b)=>Object.assign(Object.assign(Object.assign({client_id:s.clientId},s.authorizationParams),l),{scope:F(c,l.scope),response_type:"code",response_mode:b||"query",state:d,nonce:m,redirect_uri:f||s.authorizationParams.redirect_uri,code_challenge:w,code_challenge_method:"S256"}))(this.options,this.scope,e,n,r,u,e.redirect_uri||this.options.authorizationParams.redirect_uri||o,t?.response_mode),g=this._authorizeUrl(h);return{nonce:r,code_verifier:a,scope:h.scope,audience:h.audience||"default",redirect_uri:h.redirect_uri,state:n,url:g}}async loginWithPopup(e,t){var o;if(e=e||{},!(t=t||{}).popup&&(t.popup=(u=>{let h=window.screenX+(window.innerWidth-400)/2,g=window.screenY+(window.innerHeight-600)/2;return window.open(u,"auth0:authorize:popup",`left=${h},top=${g},width=400,height=600,resizable,scrollbars=yes,status=1`)})(""),!t.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");let n=await this._prepareAuthorizeUrl(e.authorizationParams||{},{response_mode:"web_message"},window.location.origin);t.popup.location.href=n.url;let r=await(u=>new Promise((h,g)=>{let s,c=setInterval(()=>{u.popup&&u.popup.closed&&(clearInterval(c),clearTimeout(l),window.removeEventListener("message",s,!1),g(new te(u.popup)))},1e3),l=setTimeout(()=>{clearInterval(c),g(new ee(u.popup)),window.removeEventListener("message",s,!1)},1e3*(u.timeoutInSeconds||60));s=function(d){if(d.data&&d.data.type==="authorization_response"){if(clearTimeout(l),clearInterval(c),window.removeEventListener("message",s,!1),u.popup.close(),d.data.response.error)return g(k.fromPayload(d.data.response));h(d.data.response)}},window.addEventListener("message",s)}))(Object.assign(Object.assign({},t),{timeoutInSeconds:t.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(n.state!==r.state)throw new k("state_mismatch","Invalid state");let a=((o=e.authorizationParams)===null||o===void 0?void 0:o.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:n.audience,scope:n.scope,code_verifier:n.code_verifier,grant_type:"authorization_code",code:r.code,redirect_uri:n.redirect_uri},{nonceIn:n.nonce,organization:a})}async getUser(){var e;let t=await this._getIdTokenFromCache();return(e=t?.decodedToken)===null||e===void 0?void 0:e.user}async getIdTokenClaims(){var e;let t=await this._getIdTokenFromCache();return(e=t?.decodedToken)===null||e===void 0?void 0:e.claims}async loginWithRedirect(e={}){var t;let o=ve(e),{openUrl:n,fragment:r,appState:a}=o,u=E(o,["openUrl","fragment","appState"]),h=((t=u.authorizationParams)===null||t===void 0?void 0:t.organization)||this.options.authorizationParams.organization,g=await this._prepareAuthorizeUrl(u.authorizationParams||{}),{url:s}=g,c=E(g,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},c),{appState:a}),h&&{organization:h}));let l=r?`${s}#${r}`:s;n?await n(l):window.location.assign(l)}async handleRedirectCallback(e=window.location.href){let t=e.split("?").slice(1);if(t.length===0)throw new Error("There are no query params available for parsing.");let{state:o,code:n,error:r,error_description:a}=(c=>{c.indexOf("#")>-1&&(c=c.substring(0,c.indexOf("#")));let l=new URLSearchParams(c);return{state:l.get("state"),code:l.get("code")||void 0,error:l.get("error")||void 0,error_description:l.get("error_description")||void 0}})(t.join("")),u=this.transactionManager.get();if(!u)throw new k("missing_transaction","Invalid state");if(this.transactionManager.remove(),r)throw new Q(r,a||r,o,u.appState);if(!u.code_verifier||u.state&&u.state!==o)throw new k("state_mismatch","Invalid state");let h=u.organization,g=u.nonce,s=u.redirect_uri;return await this._requestToken(Object.assign({audience:u.audience,scope:u.scope,code_verifier:u.code_verifier,grant_type:"authorization_code",code:n},s?{redirect_uri:s}:{}),{nonceIn:g,organization:h}),{appState:u.appState}}async checkSession(e){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(e)}catch{}}async getTokenSilently(e={}){var t;let o=Object.assign(Object.assign({cacheMode:"on"},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:F(this.scope,(t=e.authorizationParams)===null||t===void 0?void 0:t.scope)})}),n=await((r,a)=>{let u=Y[a];return u||(u=r().finally(()=>{delete Y[a],u=null}),Y[a]=u),u})(()=>this._getTokenSilently(o),`${this.options.clientId}::${o.authorizationParams.audience}::${o.authorizationParams.scope}`);return e.detailedResponse?n:n?.access_token}async _getTokenSilently(e){let{cacheMode:t}=e,o=E(e,["cacheMode"]);if(t!=="off"){let n=await this._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:this.options.clientId});if(n)return n}if(t!=="cache-only"){if(!await(async(n,r=3)=>{for(let a=0;a<r;a++)if(await n())return!0;return!1})(()=>q.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new H;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),t!=="off"){let g=await this._getEntryFromCache({scope:o.authorizationParams.scope,audience:o.authorizationParams.audience||"default",clientId:this.options.clientId});if(g)return g}let n=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(o):await this._getTokenFromIFrame(o),{id_token:r,access_token:a,oauthTokenScope:u,expires_in:h}=n;return Object.assign(Object.assign({id_token:r,access_token:a},u?{scope:u}:null),{expires_in:h})}finally{await q.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(e={},t={}){var o;let n=Object.assign(Object.assign({},e),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),e.authorizationParams),{scope:F(this.scope,(o=e.authorizationParams)===null||o===void 0?void 0:o.scope)})});return t=Object.assign(Object.assign({},Pe),t),await this.loginWithPopup(n,t),(await this.cacheManager.get(new O({scope:n.authorizationParams.scope,audience:n.authorizationParams.audience||"default",clientId:this.options.clientId}))).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(e){e.clientId!==null?e.clientId=e.clientId||this.options.clientId:delete e.clientId;let t=e.logoutParams||{},{federated:o}=t,n=E(t,["federated"]),r=o?"&federated":"";return this._url(`/v2/logout?${ne(Object.assign({clientId:e.clientId},n))}`)+r}async logout(e={}){let t=ve(e),{openUrl:o}=t,n=E(t,["openUrl"]);e.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(e.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@");let r=this._buildLogoutUrl(n);o?await o(r):o!==!1&&window.location.assign(r)}async _getTokenFromIFrame(e){let t=Object.assign(Object.assign({},e.authorizationParams),{prompt:"none"}),o=this.cookieStorage.get(this.orgHintCookieName);o&&!t.organization&&(t.organization=o);let{url:n,state:r,nonce:a,code_verifier:u,redirect_uri:h,scope:g,audience:s}=await this._prepareAuthorizeUrl(t,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new k("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");let c=e.timeoutInSeconds||this.options.authorizeTimeoutInSeconds,l=await((m,w,f=60)=>new Promise((b,S)=>{let v=window.document.createElement("iframe");v.setAttribute("width","0"),v.setAttribute("height","0"),v.style.display="none";let p=()=>{window.document.body.contains(v)&&(window.document.body.removeChild(v),window.removeEventListener("message",T,!1))},T,j=setTimeout(()=>{S(new H),p()},1e3*f);T=function(_){if(_.origin!=w||!_.data||_.data.type!=="authorization_response")return;let L=_.source;L&&L.close(),_.data.response.error?S(k.fromPayload(_.data.response)):b(_.data.response),clearTimeout(j),window.removeEventListener("message",T,!1),setTimeout(p,2e3)},window.addEventListener("message",T,!1),window.document.body.appendChild(v),v.setAttribute("src",m)}))(n,this.domainUrl,c);if(r!==l.state)throw new k("state_mismatch","Invalid state");let d=await this._requestToken(Object.assign(Object.assign({},e.authorizationParams),{code_verifier:u,code:l.code,grant_type:"authorization_code",redirect_uri:h,timeout:e.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:a,organization:t.organization});return Object.assign(Object.assign({},d),{scope:g,oauthTokenScope:d.scope,audience:s})}catch(c){throw c.error==="login_required"&&this.logout({openUrl:!1}),c}}async _getTokenUsingRefreshToken(e){let t=await this.cacheManager.get(new O({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}));if(!(t&&t.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw new B(e.authorizationParams.audience||"default",e.authorizationParams.scope)}let o=e.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,n=typeof e.timeoutInSeconds=="number"?1e3*e.timeoutInSeconds:null;try{let r=await this._requestToken(Object.assign(Object.assign(Object.assign({},e.authorizationParams),{grant_type:"refresh_token",refresh_token:t&&t.refresh_token,redirect_uri:o}),n&&{timeout:n}));return Object.assign(Object.assign({},r),{scope:e.authorizationParams.scope,oauthTokenScope:r.scope,audience:e.authorizationParams.audience||"default"})}catch(r){if((r.message.indexOf("Missing Refresh Token")>-1||r.message&&r.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(e);throw r}}async _saveEntryInCache(e){let{id_token:t,decodedToken:o}=e,n=E(e,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:t,decodedToken:o}),await this.cacheManager.setIdToken(this.options.clientId,e.id_token,e.decodedToken),await this.cacheManager.set(n)}async _getIdTokenFromCache(){let e=this.options.authorizationParams.audience||"default",t=await this.cacheManager.getIdToken(new O({clientId:this.options.clientId,audience:e,scope:this.scope})),o=this.userCache.get("@@user@@");return t&&t.id_token===o?.id_token?o:(this.userCache.set("@@user@@",t),t)}async _getEntryFromCache({scope:e,audience:t,clientId:o}){let n=await this.cacheManager.get(new O({scope:e,audience:t,clientId:o}),60);if(n&&n.access_token){let{access_token:r,oauthTokenScope:a,expires_in:u}=n,h=await this._getIdTokenFromCache();return h&&Object.assign(Object.assign({id_token:h.id_token,access_token:r},a?{scope:a}:null),{expires_in:u})}}async _requestToken(e,t){let{nonceIn:o,organization:n}=t||{},r=await He(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs},e),this.worker),a=await this._verifyIdToken(r.id_token,o,n);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},r),{decodedToken:a,scope:e.scope,audience:e.audience||"default"}),r.scope?{oauthTokenScope:r.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(n||a.claims.org_id),Object.assign(Object.assign({},r),{decodedToken:a})}};var Be=window.location.host,Ve=["/onboarding","/profile"];function Xe(i,e){return e.some(t=>i.startsWith(t))}var I={DOMAIN:"stsv3.webflow.io",AUTHO_DOMAIN:"seedtoscale.au.auth0.com",AUTHO_CLIENT_ID:"iiLfr784Qf911CWf7HhYrDRfIuVGvn6f",isProduction:Be=="www.seedtoscale.com"};console.log("[+] ENVIRONMENT",I.isProduction?"Production":"Development");var Ee={LOGIN:`https://${I.DOMAIN}/home-new`,ONBOARDING:`https://${I.DOMAIN}/onboarding`},ue={USER:`https://${I.AUTHO_DOMAIN}/api/v2/users`},de=()=>{let i=window.location.pathname;return Xe(i,Ve)};var Je=()=>{let i={domain:I.AUTHO_DOMAIN,clientId:I.AUTHO_CLIENT_ID,cacheLocation:"localstorage",authorizationParams:{audience:`https://${I.AUTHO_DOMAIN}/api/v2/`,redirect_uri:Ee.ONBOARDING,scope:"openid profile email update:current_user_metadata read:current_user"}};return new X(i)},A=Je();var Ie=async i=>{console.log("[+] AUTH MODULE INITIALIZED"),qe(A,"#login-button"),await Ge(A),await Ye(A,i)},Ge=async i=>{location.search.includes("state=")&&(location.search.includes("code=")||location.search.includes("error="))&&(await i.handleRedirectCallback(),window.history.replaceState({},document.title,"/onboarding"))},$e=async i=>{try{let e=await i.isAuthenticated();console.log("[+] !isAuthenticated && isUserOrProtectedRoute()",!e,de()),!e&&de()&&(console.log("[+] Redirecting User to Login Page"),await i.loginWithRedirect({appState:{targetUrl:window.location.pathname}}))}catch(e){console.error("redirectAnonUserFromProtectedRoute",e)}},Ye=async(i,e)=>{try{let t=await i.getTokenSilently(),o=await i.isAuthenticated(),n=await i.getUser();if(console.log("isAuthenticated",o),n){let r=n.sub||"",u=await(await fetch(`https://${I.AUTHO_DOMAIN}/api/v2/users/${encodeURIComponent(r)}`,{headers:{Authorization:`Bearer ${t}`}})).json();e(u)}}catch(t){if(console.log("checkAuthentication",t),$e(i),t.error!=="login_required")throw t}},qe=(i,e="#login-button")=>{let t=document.querySelectorAll(e);t&&t.length?(console.info("[+] Login Button Found. Installing listener"),t.forEach(o=>{console.info("[++] Listener Installed on [id]",o.id),o.addEventListener("click",n=>{n.preventDefault(),i.loginWithRedirect()})})):console.info("[-] Login Button Not Found")};var J=class{constructor(){y(this,"getAccessToken",async()=>await A.getTokenSilently());y(this,"getUser",async()=>{let e=await A.getUser();return console.log("userProfile",e),e});y(this,"getUserId",async()=>(await this.getUser())?.sub||"");y(this,"getUserWithMetadata",async()=>{let e=await this.getUserId(),t=await this.getAccessToken(),o=ue.USER+"/"+encodeURIComponent(e),r=await(await fetch(o,{headers:{Authorization:`Bearer ${t}`}})).json();return console.log("[+] User -> User Object",r),r});y(this,"updateUserMetadata",async e=>{let t=await this.getUserId(),o=await this.getAccessToken(),n=ue.USER+"/"+encodeURIComponent(t),a=await(await fetch(n,{method:"PATCH",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({user_metadata:e})})).json();console.log("[+] User - Metadata Updated",t,a)});y(this,"updateMetaDataInLocalStorage",async e=>{let t=localStorage.getItem("formState");if(!t)return;let o=JSON.parse(t),n={...o,formData:{...o.formData,...e}};localStorage.setItem("formState",JSON.stringify(n))})}};window.Webflow||(window.Webflow=[]);window.Webflow.push(()=>{let i=new J,e;function t(a){console.log("userLoaded",a),i.updateMetaDataInLocalStorage(a.user_metadata),e&&e.initialize()}let o=a=>{i.updateUserMetadata(a)},n='[data-form="multistep"]',r=document.querySelector(n);console.log("[+] form",r),r&&(e=new Z({formSelector:n,inputErrorMessageSelector:".onb-form-field-error",options:{afterSubmitRedrect:document.querySelector(n)?.getAttribute("data-redirect")||"/"},onStepChange:a=>{console.log("onStepChange",a),Object.keys(a.errors).length==0&&o(a.formData)}})),Ie(t)});})();
